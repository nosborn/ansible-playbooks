---
- name: configure network device
  ansible.builtin.template:
    src: netdev.j2
    dest: /etc/systemd/network/wg0.netdev
    owner: root
    group: systemd-network
    mode: !!str 0440
  notify: restart networking

- name: configure network
  ansible.builtin.template:
    src: network.j2
    dest: /etc/systemd/network/wg0.network
    owner: root
    group: root
    mode: !!str 0444
  notify: restart networking

- name: client configurations
  delegate_to: localhost
  ansible.builtin.template:
    src: client.conf.j2
    dest: wg-{{ wireguard_item.name }}.conf
    mode: !!str 0400
  loop: "{{ wireguard_peers }}"
  loop_control:
    label: "{{ wireguard_item.name }}"
    loop_var: wireguard_item
