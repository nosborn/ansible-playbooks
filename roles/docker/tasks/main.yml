---
- name: install packages
  ansible.builtin.apt:
    name:
      - docker.io
      - python3-docker
    install_recommends: false

- name: configure docker
  ansible.builtin.template:
    src: daemon.json.j2
    dest: /etc/docker/daemon.json
    owner: root
    group: root
    mode: 0444
  notify: restart docker

- name: enable and start start
  ansible.builtin.systemd:
    name: docker
    enabled: true
    state: started

- name: run any handler tasks
  ansible.builtin.meta: flush_handlers

- name: configure swarm
  community.docker.docker_swarm:
    advertise_addr: 127.0.0.1:4567
    state: present
