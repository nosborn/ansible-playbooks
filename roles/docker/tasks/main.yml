# roles/docker/tasks/main
---
- name: install package
  command: /usr/syno/bin/synopkg install_from_server Docker
  args:
    creates: /var/packages/Docker/INFO
  register: docker_package_result
  until: docker_package_result is succeeded

- name: install python support
  pip:
    name: docker
    extra_args: --no-cache-dir
    state: present

- name: create persistent storage
  file:
    path: /volume1/docker
    owner: root
    group: root
    mode: 0700
    state: directory

- name: create macvlan network
  docker_network:
    name: "{{ docker_macvlan_name }}"
    driver: macvlan
    driver_options:
      parent: "{{ lan_if }}"
    ipam_config:
      - gateway: "{{ hostvars['usg']['lan_ipv4_address'] }}"
        iprange: "{{ docker_macvlan_iprange }}"
        subnet: "{{ lan_ipv4_subnet }}"
