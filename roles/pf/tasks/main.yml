# roles/pf/tasks/main
---
- name: fetch IPv4 bogons
  get_url:
    url=https://www.team-cymru.org/Services/Bogons/{{ item }}
    dest=/var/db/{{ item }}
    owner=root group=wheel mode=0644
  with_items:
    - "{{ pf_bogons_v4_file }}"
  notify: reload pf
  when: pf_bogons_v4_file is defined

- name: fetch IPv6 bogons
  get_url:
    url=https://www.team-cymru.org/Services/Bogons/{{ item }}
    dest=/var/db/{{ item }}
    owner=root group=wheel mode=0644
  with_items:
    - "{{ pf_bogons_v6_file }}"
  notify: reload pf
  when: pf_bogons_v6_file is defined

- name: packet filter configuration file
  template:
    src=pf.conf.j2 dest=/etc/pf.conf
    owner=root group=wheel mode=0400
    validate='/sbin/pfctl -f %s -n'
    backup=yes
  notify: reload pf

- meta: flush_handlers
...
