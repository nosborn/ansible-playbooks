# roles/pf/tasks/main
---
- name: install packages
  openbsd_pkg:
    name: aggregate6
    state: present

# - copy:
#     content: ""
#     dest: "{{ item }}"
#     owner: root
#     group: wheel
#     mode: 0640
#     force: false
#   with_items:
#     - "{{ pf_feodo_tracker_file }}"
#     - "{{ pf_malware_tracker_file }}"
#     - "{{ pf_zeus_tracker_file }}"

- name: fetch IPv4 bogons
  get_url:
    url: "https://www.team-cymru.org/Services/Bogons/{{ pf_bogons_v4_file }}"
    dest: /var/db/{{ pf_bogons_v4_file }}
    owner: root
    group: wheel
    mode: 0644
  notify: reload pf
  when: pf_bogons_v4_file is defined

# - name: fetch IPv6 bogons
#   get_url:
#     url=https://www.team-cymru.org/Services/Bogons/{{ item }}
#     dest=/var/db/{{ item }}
#     owner=root group=wheel mode=0644
#   with_items:
#     - "{{ pf_bogons_v6_file }}"
#   notify: reload pf
#   when: pf_bogons_v6_file is defined

- name: packet filter configuration file
  template:
    src: pf.conf.j2
    dest: /etc/pf.conf
    owner: root
    group: wheel
    mode: 0400
    # validate: /sbin/pfctl -f %s -n
  notify: reload pf

- meta: flush_handlers
...
