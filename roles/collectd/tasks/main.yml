# roles/collectd/tasks/main
---
- name: install packages
  package:
    name:
      - collectd
      - collectd-ping
      - collectd-prometheus
    state: present
  register: collectd_result
  until: collectd_result is succeeded

- name: install configuration file
  template:
    src: collectd.conf.j2
    dest: /etc/collectd.conf
    owner: root
    group: _collectd
    mode: 0440
    validate: /usr/local/sbin/collectd -C %s -t
  notify: restart collectd

- name: enable and start service
  service:
    name: collectd
    enabled: true
    state: started
...
