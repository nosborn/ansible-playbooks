# roles/collectd/tasks/main
---
- include_vars: vault.yml
  no_log: true

- name: install packages
  openbsd_pkg: name={{ item }} state=present
  with_items:
    - collectd
    - collectd-rrdtool

- name: configure system statistics collection daemon
  template:
    src=collectd.conf.j2 dest=/etc/collectd.conf
    owner=root group=_collectd mode=0440
    validate='/usr/local/sbin/collectd -C %s -t'
  notify: restart collectd

- name: start system statistics collection daemon
  service: name=collectd enabled=yes state=started
...
