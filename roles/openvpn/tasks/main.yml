# roles/openvpn/tasks/main
---
- name: install package
  openbsd_pkg: name=openvpn state=installed

- file: path={{ item }} owner=root group=wheel mode=0750 state=directory
  with_items:
    - /etc/openvpn
    - /usr/local/libexec/openvpn

- name: configure secure IP tunnel daemon
  copy:
    content="{{ openvpn_config }}" dest=/etc/openvpn/tun0.conf
    owner=root group=wheel mode=0400
  notify: reload openvpn

- name: install scripts
  template:
    src={{ item }}.j2 dest=/usr/local/libexec/openvpn/{{ item }}
    owner=root group=wheel mode=0550
    validate='/bin/sh -n %s'
  with_items:
    - route-up.sh

- name: interface-specific configuration file
  template:
    src=hostname.if.j2 dest=/etc/hostname.tun0
    owner=root group=wheel mode=0440
  # notify: restart openvpn
...
