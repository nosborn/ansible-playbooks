# roles/openvpn/tasks/client
---
- name: configure secure IP tunnel daemon authentication
  copy:
    content="{{ openvpn_client_auth_user_pass }}" dest=/etc/openvpn/client.up
    owner=root group=wheel mode=0400
    backup=yes
  notify: restart openvpn client
  when: openvpn_client_auth_user_pass is defined

- name: remove secure IP tunnel daemon authentication
  file:
    path=/etc/openvpn/client.up state=absent
    backup=yes
  notify: restart openvpn client
  when: openvpn_client_auth_user_pass is not defined

- name: configure secure IP tunnel daemon
  copy:
    content="{{ openvpn_client_config }}" dest=/etc/openvpn/client.conf
    owner=root group=wheel mode=0400
    backup=yes
  notify: restart openvpn client

- name: install scripts
  template:
    src={{ item }}.j2 dest=/usr/local/libexec/openvpn/{{ item }}
    owner=root group=wheel mode=0550
    validate='/bin/ksh -n %s'
    backup=yes
  with_items:
    - client-down.sh
    - client-route-up.sh
    - client-route-pre-down.sh
    - client-up.sh
  notify: restart openvpn client

- name: interface-specific configuration file
  template:
    src=hostname.client.j2 dest=/etc/hostname.{{ vpn_client_if }}
    owner=root group=wheel mode=0440
    backup=yes
# notify: restart openvpn client
...
