# roles/openvpn/tasks/client
---
- name: configure secure IP tunnel daemon
  copy:
    content="{{ openvpn_client_config }}" dest=/etc/openvpn/tun0.conf
    owner=root group=wheel mode=0400
  notify: reload openvpn

- name: install scripts
  template:
    src={{ item }}.j2 dest=/usr/local/libexec/openvpn/{{ item }}
    owner=root group=wheel mode=0550
    validate='/bin/sh -n %s'
  with_items:
    - client-route-up.sh

- copy:
    content="{{ openvpn_client_auth_user_pass }}" dest=/etc/openvpn/client.up
    owner=root group=wheel mode=0400
  when: openvpn_client_auth_user_pass is defined
  notify: reload openvpn

- name: interface-specific configuration file
  template:
    src=hostname.if.j2 dest=/etc/hostname.tun0
    owner=root group=wheel mode=0440
  notify: restart openvpn
...
