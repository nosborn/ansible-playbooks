# roles/openvpn/tasks/client
---
- name: configure secure IP tunnel daemon
  copy:
    content="{{ openvpn_client_config }}" dest=/etc/openvpn/client.conf
    owner=root group=wheel mode=0400
  notify: reload openvpn client

- name: install scripts
  template:
    src={{ item }}.j2 dest=/usr/local/libexec/openvpn/{{ item }}
    owner=root group=wheel mode=0550
    validate='/bin/sh -n %s'
  with_items:
    - client-route-pre-down.sh
    - client-route-up.sh
  notify: reload openvpn client

- copy:
    content="{{ openvpn_client_crl }}" dest=/etc/openvpn/client.crl
    owner=root group=wheel mode=0400
  when: openvpn_client_crl is defined
  notify: reload openvpn client

- file: path=/etc/openvpn/client.crl state=absent
  when: openvpn_client_crl is not defined
  notify: reload openvpn client

- copy:
    content="{{ openvpn_client_auth_user_pass }}" dest=/etc/openvpn/client.up
    owner=root group=wheel mode=0400
  when: openvpn_client_auth_user_pass is defined
  notify: reload openvpn client

- file: path=/etc/openvpn/client.up state=absent
  when: openvpn_client_auth_user_pass is not defined
  notify: reload openvpn client

- name: interface-specific configuration file
  template:
    src=hostname.client.j2 dest=/etc/hostname.{{ vpn_client_if }}
    owner=root group=wheel mode=0440
# notify: restart openvpn
...
