---
- name: create redis volume
  community.docker.docker_volume:
    name: nitter-redis-data

- name: deploy redis
  community.docker.docker_swarm_service:
    name: nitter-redis
    image: redis:6-alpine
    command: redis-server --save 60 1 --loglevel warning
    env:
      TZ: "{{ timezone }}"
    healthcheck:
      test: redis-cli ping || exit 1
    mounts:
      - source: nitter-redis-data
        target: /data
        type: volume
    networks:
      - name: nitter
    read_only: true
    labels:
      traefik.enable: !!str false
    container_labels:
      com.centurylinklabs.watchtower.enable: !!str true
    restart_config:
      condition: on-failure
      delay: 20s
