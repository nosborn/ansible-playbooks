# yamllint disable rule:line-length
---
- name: create namespace
  kubernetes.core.k8s:
    apply: true
    resource_definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: linkerd
    server_side_apply:
      field_manager: ansible

- kubernetes.core.k8s:
    apply: true
    namespace: linkerd
    resource_definition:
      apiVersion: v1
      kind: Secret
      metadata:
        annotations: {}
        labels:
          app.kubernetes.io/managed-by: Ansible
        name: helm-values
      data:
        identity_issuer_certificate: "{{ linkerd_identity_issuer_certificate | b64encode }}"
        identity_issuer_key: "{{ linkerd_identity_issuer_key | b64encode }}"
        identity_trust_anchors: "{{ linkerd_identity_trust_anchors | b64encode }}"
      type: Opaque
    server_side_apply:
      field_manager: ansible
