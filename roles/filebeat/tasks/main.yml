---
- name: install binary
  copy:
    src: "{{ ansible_architecture }}/filebeat"
    dest: /usr/local/bin/filebeat
    owner: root
    group: root
    mode: 0555
  # notify: restart filebeat

- file:
    path: "{{ item }}"
    owner: root
    group: root
    mode: 0755
    state: directory
  with_items:
    - /etc/filebeat
    - /etc/filebeat/modules.d

- name: install configuration file
  template:
    src: filebeat.yml.j2
    dest: /etc/filebeat/filebeat.yml
    owner: root
    group: root
    mode: 0444
  # notify: restart filebeat

- copy:
    src: filebeat.sh
    dest: /etc/init.d/filebeat
    owner: root
    group: root
    mode: 0555
    validate: sh -n %s
  notify: restart filebeat
  when: false

- name: enable and start service
  service:
    name: filebeat
    enabled: true
    state: started
  when: false
...
