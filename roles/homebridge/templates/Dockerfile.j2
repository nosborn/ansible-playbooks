FROM alpine:3.12

RUN apk add --no-cache \
		nodejs=12.18.3-r0 \
		npm=12.18.3-r0 \
		tzdata=2020a-r0 \
	&& cp '/usr/share/zoneinfo/{{ timezone }}' /etc/localtime \
	&& echo '{{ timezone }}' >/etc/timezone \
	&& apk del --no-cache --purge tzdata \
	&& npm set global-style=true \
	&& npm set package-lock=false \
	&& npm install -g --unsafe-perm \
		homebridge@{{ homebridge_version }} \
		homebridge-config-ui-x@4.27.1 \
		homebridge-unifi-occupancy-sensor@1.0.0 \
	&& mkdir /homebridge

VOLUME /homebridge
VOLUME /homebridge/config.json

EXPOSE 80/tcp

CMD ["/usr/bin/homebridge", "-D", "-U", "/homebridge"]
