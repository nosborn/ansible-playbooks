---
- name: configure acme-client
  ansible.builtin.template:
    src: acme-client.conf.j2
    dest: /etc/acme-client.conf
    owner: root
    group: wheel
    mode: 0444
    validate: acme-client -n -f %s

- name: issue certificate
  ansible.builtin.command:
    argv:
      - acme-client
      - "{{ ansible_fqdn }}"
    creates: /etc/ssl/{{ ansible_fqdn }}.fullchain.pem
