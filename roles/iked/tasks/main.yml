# roles/iked/tasks/main
---
- name: interface-specific configuration file
  template:
    src=hostname.enc0.j2 dest=/etc/hostname.enc0
    owner=root group=wheel mode=0440
  notify: netstart

- name: IKEv2 configuration file
  template:
    src=iked.conf.j2 dest=/etc/iked.conf
    owner=root group=wheel mode=0400
    # validate='/sbin/iked -f %s -n'
  notify: restart iked

- copy:
    src=iked dest=/etc/rc.d/iked
    owner=root group=wheel mode=0555
    validate='/bin/sh -n %s'

- template:
    src=ikeca.cnf dest=/etc/ssl/ikeca.cnf
    owner=root group=wheel mode=0444

- meta: flush_handlers

- name: start IKEv2 daemon
  service: name=iked arguments='-6' enabled=yes state=started

- include: 'pki.yml'
- include: 'mobileconfig.yml'
...
