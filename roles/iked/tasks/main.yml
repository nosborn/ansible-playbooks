# roles/iked/tasks/main
---
- include_vars: vault.yml
  no_log: true

- name: IKEv2 configuration file
  template:
    src=iked.conf.j2 dest=/etc/iked.conf
    owner=root group=wheel mode=0400
  # validate='/sbin/iked -f %s -n'
  notify: restart iked

- copy:
    src=iked dest=/etc/rc.d/iked
    owner=root group=wheel mode=0555
    validate='/bin/sh -n %s'

#- name: sysctl variables to set at system startup
#  sysctl:
#    name={{ item.key }} value={{ item.value }}
#    reload=no sysctl_set=yes
#  with_dict:
#    net.inet.ah.enable: 0

- meta: flush_handlers

- name: start IKEv2 daemon
  service: name=iked arguments=-6 enabled={{ iked_enabled }} state={{ iked_state }}

- include: mobileconfig.yml
...
