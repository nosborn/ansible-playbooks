# roles/iked/tasks/main
---
- include_vars: vault.yml
  no_log: true

- name: interface-specific configuration file
  template:
    src=hostname.enc0.j2 dest=/etc/hostname.enc0
    owner=root group=wheel mode=0440
  notify: netstart

- name: IKEv2 configuration file
  template:
    src=iked.conf.j2 dest=/etc/iked.conf
    owner=root group=wheel mode=0400
  # validate='/sbin/iked -f %s -n'
  notify: restart iked

- copy:
    src=iked dest=/etc/rc.d/iked
    owner=root group=wheel mode=0555
    validate='/bin/sh -n %s'

- name: sysctl variables to set at system startup
  sysctl:
    name={{ item.key }} value={{ item.value }}
    reload=no sysctl_set=yes
  with_dict:
  # net.inet.ah.enable: 0
    net.inet.ipcomp.enable: 1

- meta: flush_handlers

- name: start IKEv2 daemon
  service: name=iked arguments=-6 enabled=yes state=started

- include: mobileconfig.yml
...
