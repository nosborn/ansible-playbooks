# roles/nginx/tasks/site
---
- include: roles/letsencrypt/tasks/domain.yml domain={{ site.name }}
  notify: restart nginx

- file:
    path={{ item }} state=directory
    owner=root group=wheel mode=0775
  with_items:
    - /var/www/sites/{{ site.name }}
    - /var/www/sites/{{ site.name }}/shared
  when: site.redirect is not defined

- template:
    src=site.conf.j2 dest=/etc/nginx/sites.d/{{ site.name }}.conf
    owner=root group=wheel mode=0444
  notify: restart nginx
...
