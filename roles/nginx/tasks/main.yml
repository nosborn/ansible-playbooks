# roles/nginx/tasks/main
---
- name: install package
  openbsd_pkg: name=nginx state=present

- name: sites configuration directory
  file:
    path=/etc/nginx/sites.d state=directory
    owner=root group=wheel mode=0755

- name: sites root directory
  file:
    path=/var/www/sites state=directory
    owner=root group=daemon mode=0755

- name: main configuration file
  template:
    src=nginx.conf.j2 dest=/etc/nginx/nginx.conf
    owner=root group=wheel mode=0444
    validate='/usr/local/sbin/nginx -c %s -t'
  notify: restart nginx

- name: enable and start service
  service: name=nginx enabled=yes state=started

- name: configure sites
  include: site.yml site={{ nginx_item }}
  with_items: "{{ sites }}"
  loop_control:
    loop_var: nginx_item

- command: /usr/local/bin/gixy

- lineinfile:
    path=/etc/newsyslog.conf
    regexp='^/var/www/logs/access.log\s'
    line='/var/www/logs/access.log\t\t644  4     *    $W0   ZB /var/run/nginx.pid SIGUSR1'

- lineinfile:
    path=/etc/newsyslog.conf
    regexp='^/var/www/logs/error.log\s'
    line='/var/www/logs/error.log\t\t644  7     250  *     ZB /var/run/nginx.pid SIGUSR1'
...
