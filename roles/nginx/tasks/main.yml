# roles/nginx/tasks/main
---
- name: install package
  openbsd_pkg: name=nginx-- state=installed

- name: sites configuration directory
  file:
    path=/etc/nginx/sites.d state=directory
    owner=root group=wheel mode=0755

- name: sites root directory
  file:
    path=/var/www/sites state=directory
    owner=root group=daemon mode=0755

- name: main configuration file
  template:
    src=nginx.conf.j2 dest=/etc/nginx/nginx.conf
    owner=root group=wheel mode=0444
    validate='/usr/local/sbin/nginx -c %s -t'
  notify: restart nginx

- name: start service
  service: name=nginx enabled=yes state=started

- name: configure sites
  include: site.yml name={{ nginx_item }}
  with_items: "{{ letsencrypt_domains }}"
  loop_control:
    loop_var: nginx_item
...
