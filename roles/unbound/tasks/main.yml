# roles/unbound/tasks/main
---
- copy:
    src=named.root dest=/var/unbound/etc/named.root
    owner=root group=wheel mode=0444
  notify: reload unbound

- template:
    src={{ item }}.j2 dest=/var/unbound/etc/{{ item }}
    owner=root group=wheel mode=0444
  with_items:
    - domains
    - hosts
  notify: reload unbound

- name: temporary configuration file
  template:
    src=unbound.conf.j2 dest=/var/unbound/etc/.unbound.conf
    owner=root group=wheel mode=0440

- name: configuration file
  copy:
    src=/var/unbound/etc/.unbound.conf dest=/var/unbound/etc/unbound.conf
    owner=root group=wheel mode=0444
    remote_src=yes
    validate='/usr/sbin/unbound-checkconf %s'
  notify: reload unbound

- name: start DNS resolver
  service: name=unbound enabled=yes state=started
...
