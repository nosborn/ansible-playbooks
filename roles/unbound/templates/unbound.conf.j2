server:
	verbosity: 1

	interface: {{ unbound_ipv4_address }}
	outgoing-interface: {{ unbound_ipv4_address }}

	# edns-buffer-size: 1472

	# msg-cache-size: 128m

	# rrset-cache-size: 256m

	define-tag: "guest iot main"

	do-ip6: no

	#Â edns-tcp-keepalive: yes

	tls-cert-bundle: "/etc/ssl/cert.pem"

	do-daemonize: no

	access-control: 0.0.0.0/0 refuse
	access-control: {{ lan_ipv4_subnet }} allow

	access-control-tag: {{ guest_ipv4_subnet }} "guest"
	access-control-tag: {{ iot_ipv4_subnet }} "iot"
	access-control-tag: {{ lan_ipv4_subnet }} "main"

	logfile: ""
	log-queries: yes
	# log-replies: yes
	log-tag-queryreply: yes
	log-local-actions: yes
	log-servfail: yes

	root-hints: /usr/share/dns-root-hints/named.root

	hide-identity: yes
	hide-version: yes
	hide-trustanchor: yes

	private-address: 0.0.0.0/8
	private-address: 10.0.0.0/8         # Private-Use
	private-address: 100.64.0.0/10      # Shared Address Space
	private-address: 127.0.0.0/8        # Loopback
	private-address: 169.254.0.0/16     # Link Local
	private-address: 172.16.0.0/12      # Private-Use
	private-address: 192.0.2.0/24       # Documentation (TEST-NET-1)
	private-address: 192.168.0.0/16     # Private-Use
	private-address: 198.18.0.0/15      # Benchmarking
	private-address: 198.51.100.0/24    # Documentation (TEST-NET-2)
	private-address: 203.0.113.0/24     # Documentation (TEST-NET-3)
	private-address: 240.0.0.0/4        # Reserved
	private-address: 255.255.255.255/32 # Limited Broadcast
	private-address: fd00::/8
	private-address: fe80::/10
	private-address: ::ffff:0:0/96

	private-domain: "lan"
	private-domain: "localdomain"

	do-not-query-localhost: yes

	module-config: "iterator"
	# trust-anchor-file: "/usr/share/dnssec-root/trusted-key.key"

	# domain-insecure: "lan"
	# domain-insecure: "localdomain"

	# local-zone: "localhost." nodefault
	# local-zone: "127.in-addr.arpa." nodefault
	# local-zone: "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa." nodefault
	# local-zone: "onion." nodefault
	# local-zone: "test." nodefault
	# local-zone: "invalid." nodefault
	# local-zone: "10.in-addr.arpa." nodefault
	# local-zone: "16.172.in-addr.arpa." nodefault
	# local-zone: "17.172.in-addr.arpa." nodefault
	# local-zone: "18.172.in-addr.arpa." nodefault
	# local-zone: "19.172.in-addr.arpa." nodefault
	# local-zone: "20.172.in-addr.arpa." nodefault
	# local-zone: "21.172.in-addr.arpa." nodefault
	# local-zone: "22.172.in-addr.arpa." nodefault
	# local-zone: "23.172.in-addr.arpa." nodefault
	# local-zone: "24.172.in-addr.arpa." nodefault
	# local-zone: "25.172.in-addr.arpa." nodefault
	# local-zone: "26.172.in-addr.arpa." nodefault
	# local-zone: "27.172.in-addr.arpa." nodefault
	# local-zone: "28.172.in-addr.arpa." nodefault
	# local-zone: "29.172.in-addr.arpa." nodefault
	# local-zone: "30.172.in-addr.arpa." nodefault
	# local-zone: "31.172.in-addr.arpa." nodefault
	# local-zone: "168.192.in-addr.arpa." nodefault
	# local-zone: "0.in-addr.arpa." nodefault
	# local-zone: "254.169.in-addr.arpa." nodefault
	# local-zone: "2.0.192.in-addr.arpa." nodefault
	# local-zone: "100.51.198.in-addr.arpa." nodefault
	# local-zone: "113.0.203.in-addr.arpa." nodefault
	# local-zone: "255.255.255.255.in-addr.arpa." nodefault
	# local-zone: "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa." nodefault
	# local-zone: "d.f.ip6.arpa." nodefault
	# local-zone: "8.e.f.ip6.arpa." nodefault
	# local-zone: "9.e.f.ip6.arpa." nodefault
	# local-zone: "a.e.f.ip6.arpa." nodefault
	# local-zone: "b.e.f.ip6.arpa." nodefault
	# local-zone: "8.b.d.0.1.0.0.2.ip6.arpa." nodefault
	# And for 64.100.in-addr.arpa. to 127.100.in-addr.arpa.
{% for zone in unbound_nodefault_local_zones %}
	local-zone: "{{ zone }}." nodefault
{% endfor %}

	# unblock-lan-zones: no
	# insecure-lan-zones: no

	local-zone: "use-application-dns.net." static

	local-data: "diskstation.{{ global_domain }}. A {{ diskstation_ipv4_address }}"
	local-data: "unifi.{{ global_domain }}. A {{ hostvars['unifi']['lan_ipv4_address'] }}"

	include: "/etc/unbound/blacklist.conf"

remote-control:
	control-enable: yes
	control-interface: /run/unbound.control
	control-use-cert: no

{% for zone in unbound_nodefault_local_zones %}
forward-zone:
	name: "{{ zone }}."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-tls-upstream: no
	forward-no-cache: yes

{% endfor %}
forward-zone:
	name: "lan."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

forward-zone:
	name: "localdomain."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

{% for domain in isp_domains %}
forward-zone:
	name: "{{ domain }}."
{%   for address in isp_nameservers %}
	forward-addr: {{ address }}
{%   endfor %}

{% endfor %}
{% for domain in mediastreamer_exclusions %}
forward-zone:
	name: "{{ domain }}."
{%   for address in unbound_forwarders %}
	forward-addr: {{ address }}
{%   endfor %}
	forward-tls-upstream: yes

{% endfor %}
{% for domain in mediastreamer_domains %}
forward-zone:
	name: "{{ domain }}."
{%   for address in mediastreamer_nameservers %}
	forward-addr: {{ address }}
{%   endfor %}

{% endfor %}
forward-zone:
	name: "."
{% for address in unbound_forwarders %}
	forward-addr: {{ address }}
{% endfor %}
	forward-tls-upstream: yes
