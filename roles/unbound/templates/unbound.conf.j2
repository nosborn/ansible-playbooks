server:
	verbosity: 1

	interface: 0.0.0.0
	# interface: ::0

	# outgoing-interface: 192.0.2.153
	# outgoing-interface: 2001:DB8::5
	# outgoing-interface: 2001:DB8::6
	# outgoing-interface: 2001:DB8::/64

	edns-buffer-size: 1472

	msg-cache-size: 128m

	so-reuseport: yes

	rrset-cache-size: 256m

	# do-ip4: yes
	do-ip6: no
	# prefer-ip6: yes
	# do-udp: yes
	# do-tcp: yes
	# tcp-upstream: no

	edns-tcp-keepalive: yes

	do-daemonize: no

	access-control: 0.0.0.0/0 refuse
	access-control: 127.0.0.0/8 allow
	access-control: {{ lan_ipv4_subnet }} allow
	access-control: ::0/0 refuse
	access-control: ::1 allow
	access-control: ::ffff:127.0.0.1 allow

	logfile: ""
	log-queries: no
	log-replies: no
	log-tag-queryreply: yes
	log-local-actions: no
	log-servfail: yes

	root-hints: /usr/share/dns-root-hints/named.root

	hide-identity: yes
	hide-version: yes
	hide-trustanchor: yes

	harden-glue: yes
	harden-below-nxdomain: yes
	harden-referral-path: yes
	harden-algo-downgrade: yes

	# qname-minimisation: yes
	# qname-minimisation-strict: no

	private-address: 10.0.0.0/8
	private-address: 172.16.0.0/12
	private-address: 192.168.0.0/16
	private-address: 169.254.0.0/16
	private-address: fd00::/8
	private-address: fe80::/10
	private-address: ::ffff:0:0/96

	private-domain: "lan"
	private-domain: "localdomain"

	# do-not-query-address: 127.0.0.1/8
	# do-not-query-address: ::1
	do-not-query-localhost: yes

	prefetch: yes
	# prefetch-key: yes

	deny-any: yes

	module-config: "iterator"

	# domain-insecure: "lan"
	# domain-insecure: "localdomain"

	# local-zone: "localhost." nodefault
	# local-zone: "127.in-addr.arpa." nodefault
	# local-zone: "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa." nodefault
	# local-zone: "onion." nodefault
	# local-zone: "test." nodefault
	# local-zone: "invalid." nodefault
	# local-zone: "10.in-addr.arpa." nodefault
	# local-zone: "16.172.in-addr.arpa." nodefault
	# local-zone: "17.172.in-addr.arpa." nodefault
	# local-zone: "18.172.in-addr.arpa." nodefault
	# local-zone: "19.172.in-addr.arpa." nodefault
	# local-zone: "20.172.in-addr.arpa." nodefault
	# local-zone: "21.172.in-addr.arpa." nodefault
	# local-zone: "22.172.in-addr.arpa." nodefault
	# local-zone: "23.172.in-addr.arpa." nodefault
	# local-zone: "24.172.in-addr.arpa." nodefault
	# local-zone: "25.172.in-addr.arpa." nodefault
	# local-zone: "26.172.in-addr.arpa." nodefault
	# local-zone: "27.172.in-addr.arpa." nodefault
	# local-zone: "28.172.in-addr.arpa." nodefault
	# local-zone: "29.172.in-addr.arpa." nodefault
	# local-zone: "30.172.in-addr.arpa." nodefault
	# local-zone: "31.172.in-addr.arpa." nodefault
	# local-zone: "168.192.in-addr.arpa." nodefault
	# local-zone: "0.in-addr.arpa." nodefault
	# local-zone: "254.169.in-addr.arpa." nodefault
	# local-zone: "2.0.192.in-addr.arpa." nodefault
	# local-zone: "100.51.198.in-addr.arpa." nodefault
	# local-zone: "113.0.203.in-addr.arpa." nodefault
	# local-zone: "255.255.255.255.in-addr.arpa." nodefault
	# local-zone: "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa." nodefault
	# local-zone: "d.f.ip6.arpa." nodefault
	# local-zone: "8.e.f.ip6.arpa." nodefault
	# local-zone: "9.e.f.ip6.arpa." nodefault
	# local-zone: "a.e.f.ip6.arpa." nodefault
	# local-zone: "b.e.f.ip6.arpa." nodefault
	# local-zone: "8.b.d.0.1.0.0.2.ip6.arpa." nodefault
	# And for 64.100.in-addr.arpa. to 127.100.in-addr.arpa.
{% for zone in unbound_nodefault_local_zones %}
	local-zone: "{{ zone }}." nodefault
{% endfor %}

	# unblock-lan-zones: no
	# insecure-lan-zones: no

	local-data: "unifi.{{ global_domain }}. A {{ hostvars['unifi']['lan_ipv4_address'] }}"

	local-data: "c.news.apple. A 0.0.0.0"
	local-data: "c.news.apple. AAAA ::"

	# cipher setting for TLSv1.2
	# tls-ciphers: "DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256"
	# cipher setting for TLSv1.3
	# tls-ciphersuites: "TLS_AES_128_GCM_SHA256:TLS_AES_128_CCM_8_SHA256:TLS_AES_128_CCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256"

	# request upstream over TLS (with plain DNS inside the TLS stream).
	# Default is no.  Can be turned on and off with unbound-control.
	# tls-upstream: no

	# Certificates used to authenticate connections made upstream.
	tls-cert-bundle: "/etc/ssl/cert.pem"

remote-control:
	control-enable: no

{% for zone in unbound_nodefault_local_zones %}
forward-zone:
	name: "{{ zone }}."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

{% endfor %}
forward-zone:
	name: "lan."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

forward-zone:
	name: "localdomain."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

{% for mediastreamer_domain in mediastreamer_domains %}
forward-zone:
	name: "{{ mediastreamer_domain }}."
{%   for address in unbound_mediastreamer_forwarders %}
	forward-addr: {{ address }}
{%   endfor %}
	forward-tls-upstream: no

{% endfor %}
forward-zone:
	name: "."
{% for address in unbound_default_forwarders %}
	forward-addr: {{ address }}
{% endfor %}
	forward-tls-upstream: yes
