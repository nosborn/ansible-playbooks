server:
	verbosity: 1

	interface: 127.0.0.1
	interface: {{ lan_ipv4_address }}
	# interface: {{ guest_ipv4_address }}
	# interface: {{ iot_ipv4_address }}
	interface: ::1
	interface: {{ lan_ipv6_address }}

	define-tag: "guest iot main"

	prefer-ip6: yes
	outgoing-range: 425

	msg-cache-size: 32m
	msg-cache-slabs: 2

	rrset-cache-size: 64m
	rrset-cache-slabs: 2

	infra-cache-slabs: 2

	# edns-tcp-keepalive: yes

	tls-cert-bundle: "/etc/ssl/cert.pem"

	access-control: 0.0.0.0/0 refuse
	access-control: {{ lan_ipv4_subnet }} allow
	access-control: {{ guest_ipv4_subnet }} allow
	access-control: {{ iot_ipv4_subnet }} allow
	access-control: 127.0.0.0/8 allow
	access-control: ::0/0 deny
	access-control: ::1 allow

	log-queries: yes
	# log-replies: yes
	# log-tag-queryreply: yes
	log-servfail: yes
	pidfile: /var/run/unbound.pid

	hide-identity: yes
	hide-version: yes

	aggressive-nsec: yes
	private-address: 0.0.0.0/8
	private-address: 10.0.0.0/8         # Private-Use
	private-address: 100.64.0.0/10      # Shared Address Space
	private-address: 127.0.0.0/8        # Loopback
	private-address: 169.254.0.0/16     # Link Local
	private-address: 172.16.0.0/12      # Private-Use
	private-address: 192.0.2.0/24       # Documentation (TEST-NET-1)
	private-address: 192.168.0.0/16     # Private-Use
	private-address: 198.18.0.0/15      # Benchmarking
	private-address: 198.51.100.0/24    # Documentation (TEST-NET-2)
	private-address: 203.0.113.0/24     # Documentation (TEST-NET-3)
	private-address: 240.0.0.0/4        # Reserved
	private-address: 255.255.255.255/32 # Limited Broadcast
	private-address: fd00::/8
	private-address: fe80::/10
	private-address: ::ffff:0:0/96
	private-domain: "lan"
	private-domain: "localdomain"
	private-domain: "onion"

	deny-any: yes

	module-config: "respip validator iterator"

	auto-trust-anchor-file: "/var/unbound/db/root.key"

	# domain-insecure: "lan"
	# domain-insecure: "localdomain"

	val-log-level: 2

	key-cache-slabs: 2

	# local-zone: "0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa." nodefault
	# local-zone: "0.in-addr.arpa." nodefault
	# local-zone: "1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa." nodefault
	# local-zone: "10.in-addr.arpa." nodefault
	# local-zone: "100.51.198.in-addr.arpa." nodefault
	# local-zone: "113.0.203.in-addr.arpa." nodefault
	# local-zone: "127.in-addr.arpa." nodefault
	# local-zone: "16.172.in-addr.arpa." nodefault
	# local-zone: "168.192.in-addr.arpa." nodefault
	# local-zone: "17.172.in-addr.arpa." nodefault
	# local-zone: "18.172.in-addr.arpa." nodefault
	# local-zone: "19.172.in-addr.arpa." nodefault
	# local-zone: "2.0.192.in-addr.arpa." nodefault
	# local-zone: "20.172.in-addr.arpa." nodefault
	# local-zone: "21.172.in-addr.arpa." nodefault
	# local-zone: "22.172.in-addr.arpa." nodefault
	# local-zone: "23.172.in-addr.arpa." nodefault
	# local-zone: "24.172.in-addr.arpa." nodefault
	# local-zone: "25.172.in-addr.arpa." nodefault
	# local-zone: "254.169.in-addr.arpa." nodefault
	# local-zone: "255.255.255.255.in-addr.arpa." nodefault
	# local-zone: "26.172.in-addr.arpa." nodefault
	# local-zone: "27.172.in-addr.arpa." nodefault
	# local-zone: "28.172.in-addr.arpa." nodefault
	# local-zone: "29.172.in-addr.arpa." nodefault
	# local-zone: "30.172.in-addr.arpa." nodefault
	# local-zone: "31.172.in-addr.arpa." nodefault
	# local-zone: "8.b.d.0.1.0.0.2.ip6.arpa." nodefault
	# local-zone: "8.e.f.ip6.arpa." nodefault
	# local-zone: "9.e.f.ip6.arpa." nodefault
	# local-zone: "a.e.f.ip6.arpa." nodefault
	# local-zone: "b.e.f.ip6.arpa." nodefault
	# local-zone: "d.f.ip6.arpa." nodefault
	# local-zone: "invalid." nodefault
	# local-zone: "localhost." nodefault
	# local-zone: "test." nodefault
{% for zone in unbound_nodefault_local_zones %}
	local-zone: "{{ zone }}." nodefault
{% endfor %}

	# unblock-lan-zones: no
	# insecure-lan-zones: no

	# https://support.mozilla.org/en-US/kb/canary-domain-use-application-dnsnet
	local-zone: "use-application-dns.net." static

	local-zone: "3yqjsrczwwp.com." static
	local-zone: "7hor9gul4s.com." static
	local-zone: "a4mt150303tl.com." static
	local-zone: "adservice.google.com." static
	local-zone: "adservice.google.com.sg." static
	local-zone: "api.revenuecat.com." static
	local-zone: "app-analytics.snapchat.com." static
	local-zone: "app-measurement.com." static
	local-zone: "apu.samsungelectronics.com." static
	local-zone: "au79nt5wic4x.com." static
	local-zone: "bpu.samsungelectronics.com." static
	local-zone: "captive.roku.com." static
	local-zone: "channel4.sc.omtrdc.net." static
	local-zone: "codepush.appcenter.ms." static
	local-zone: "cpu.samsungelectronics.com." static
	local-zone: "crashlyticsreports-pa.googleapis.com." static
	local-zone: "diagnostics.meethue.com." static
	local-zone: "dpu.samsungelectronics.com." static
	local-zone: "e.reddit.com." static
	local-zone: "firebaselogging.googleapis.com." static
	local-zone: "getup.today." static
	local-zone: "graph.facebook.com." static
	local-zone: "gstaticadssl.l.google.com." static
	local-zone: "hits-secure.theguardian.com." static
	local-zone: "icons.duckduckgo.icons." static
	local-zone: "iphonesubmissions.apple.com." static
	local-zone: "kpu.samsungelectronics.com." static
	local-zone: "metrics.icloud.com." static
	local-zone: "metrics.tfe.apple-dns.net." static
	local-zone: "myadcash.com." static
	local-zone: "mybbc-analytics.files.bbci.co.uk." static
	local-zone: "nui.media." static
	local-zone: "pixel.facebook.com." static
	local-zone: "r023m83skv5v.com." static
	local-zone: "socialbars-web1.com." static
	local-zone: "socialbars-web5.com." static
	local-zone: "telemetry-in.battle.net." static
	local-zone: "teleport.soom.la." static
	local-zone: "trace.svc.ui.com." static
	local-zone: "txt.chatango.com." static
	local-zone: "unifi-report.ubnt.com." static
	local-zone: "upu.samsungelectronics.com." static
	local-zone: "w7zglmcdreij.com." static
	local-zone: "win10.ipv6.microsoft.com." static
	local-zone: "win1710.ipv6.microsoft.com." static
	local-zone: "xpu.samsungelectronics.com." static
	local-zone: "ypu.samsungelectronics.com." static
	local-zone: "zav4gln44kez.com." static
	local-zone: "zpu.samsungelectronics.com." static

	# DNS-over-HTTPS
	local-zone: "dns.google.com." static
	local-zone: "dig.bdurl.net." static
	local-zone: "doh.dns.apple.com." static

	local-data: "tombstone.{{ domain_name }}. A {{ hostvars.tombstone.lan_ipv4_address }}"
	local-data: "tombstone.{{ domain_name }}. AAAA {{ hostvars.tombstone.lan_ipv6_address }}"
	local-data: "unifi.{{ domain_name }}. A {{ hostvars.unifi.lan_ipv4_address }}"
	local-data: "unifi.{{ domain_name }}. AAAA {{ hostvars.unifi.lan_ipv6_address }}"

	# include: "/var/unbound/etc/blacklist.conf"

remote-control:
	control-enable: yes
	control-interface: /var/run/unbound.sock
	control-use-cert: no

{% for zone in unbound_nodefault_local_zones %}
forward-zone:
	name: "{{ zone }}."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-tls-upstream: no
	forward-no-cache: yes

{% endfor %}
forward-zone:
	name: "lan."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

forward-zone:
	name: "localdomain."
	forward-addr: "{{ hostvars['usg']['lan_ipv4_address'] }}"
	forward-no-cache: yes

{% for domain in smartdns_exclusions %}
forward-zone:
	name: "{{ domain }}."
{%   for address in unbound_forwarders %}
	forward-addr: {{ address }}
{%   endfor %}
	forward-tls-upstream: yes

{% endfor %}
{% for domain in smartdns_domains %}
forward-zone:
	name: "{{ domain }}."
{%   for address in smartdns_servers %}
	forward-addr: {{ address }}
{%   endfor %}

{% endfor %}
{% for domain in unbound_forward_domains %}
forward-zone:
	name: "{{ domain }}."
{%   for address in unbound_forwarders %}
	forward-addr: {{ address }}
{%   endfor %}
	forward-tls-upstream: yes

{% endfor %}
rpz:
	name: "blacklist"
	zonefile: "/var/unbound/db/rpz.blacklist"
	rpz-log: yes
	# tags: "iot main"
